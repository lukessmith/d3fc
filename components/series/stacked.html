<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Stacked Series</title>
    <meta name="description" content="A collection of components that make it easy to build interactive charts with D3.">

    <script src="../../scripts.js"></script>

    <link rel="icon" type="image/png" href="../../images/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="../../images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../images/favicon-96x96.png" sizes="96x96">
    <link rel="stylesheet" href="../../styles.css" />
  </head>
  <body>
    <div class="content">

      <nav class="navbar navbar-inverse">
        <div class="container">
            <div class="navbar-header">
              <a href="../../"><img class="navbar-logo" alt="d3fc" src="../../images/logo.svg" /></a>
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              </div>
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav navbar-right">
                <li><a href="../..#quick-start">Quick Start</a></li>
                <li class="active"><a href="../../components/introduction/1-getting-started.html">Documentation</a></li>
                <li class=""><a href="../../examples">Examples</a></li>
                <li><a href="https://github.com/ScottLogic/d3fc">GitHub</a></li>
              </ul>
            </div>
        </div>
      </nav>

      
<div class="container component">

  <div class="row">

    <div class="col-sm-9 col-xs-12">
      <h1>
        Stacked Series
        <a href="https://github.com/ScottLogic/d3fc/blob/master/src/series/stacked">View source on GitHub</a>
      </h1>

      <p>The stacked series (bar, area and line) components render multiple series of data in a stacked form. The data needs to be presented to the component as multiple distinct series, where each datapoint exposes <code>y</code> and <code>y0</code> properties, where the <code>y0</code> property indicates the offset required to stack the series.</p>
<p>If the data is loaded via <code>d3.csv</code>, it is converted to an array of objects, one per row, with properties names derived from the CSV &#39;column&#39; headings. The easiest way to manipulate the data into multiple series (one per &#39;column&#39;), is to use <a href="/components/data/spread.html"><code>d3.data.spread</code></a> component. Following this <code>d3.layout.stack</code> can be used to stack the data, providing the required <code>y0</code> property.</p>
<p>The following example shows how to manipulate some data into the required form, then configures the stacked bar series accordingly:</p>
<pre><code class="language-js"><span class="keyword">var</span> data = [
 {<span class="string">"State"</span>:<span class="string">"AL"</span>,<span class="string">"Under 5 Years"</span>:<span class="string">"310"</span>,<span class="string">"5 to 13 Years"</span>:<span class="string">"552"</span>,<span class="string">"14 to 17 Years"</span>:<span class="string">"259"</span>,<span class="string">"18 to 24 Years"</span>:<span class="string">"450"</span>,<span class="string">"25 to 44 Years"</span>:<span class="string">"1215"</span>,<span class="string">"45 to 64 Years"</span>:<span class="string">"641"</span>},
 {<span class="string">"State"</span>:<span class="string">"AK"</span>,<span class="string">"Under 5 Years"</span>:<span class="string">"52"</span>,<span class="string">"5 to 13 Years"</span>:<span class="string">"85"</span>,<span class="string">"14 to 17 Years"</span>:<span class="string">"42"</span>,<span class="string">"18 to 24 Years"</span>:<span class="string">"74"</span>,<span class="string">"25 to 44 Years"</span>:<span class="string">"183"</span>,<span class="string">"45 to 64 Years"</span>:<span class="string">"50"</span>},
 {<span class="string">"State"</span>:<span class="string">"AZ"</span>,<span class="string">"Under 5 Years"</span>:<span class="string">"515"</span>,<span class="string">"5 to 13 Years"</span>:<span class="string">"828"</span>,<span class="string">"14 to 17 Years"</span>:<span class="string">"362"</span>,<span class="string">"18 to 24 Years"</span>:<span class="string">"601"</span>,<span class="string">"25 to 44 Years"</span>:<span class="string">"1804"</span>,<span class="string">"45 to 64 Years"</span>:<span class="string">"1523"</span>},
 {<span class="string">"State"</span>:<span class="string">"AR"</span>,<span class="string">"Under 5 Years"</span>:<span class="string">"202"</span>,<span class="string">"5 to 13 Years"</span>:<span class="string">"343"</span>,<span class="string">"14 to 17 Years"</span>:<span class="string">"157"</span>,<span class="string">"18 to 24 Years"</span>:<span class="string">"264"</span>,<span class="string">"25 to 44 Years"</span>:<span class="string">"754"</span>,<span class="string">"45 to 64 Years"</span>:<span class="string">"727"</span>},
 {<span class="string">"State"</span>:<span class="string">"CO"</span>,<span class="string">"Under 5 Years"</span>:<span class="string">"358"</span>,<span class="string">"5 to 13 Years"</span>:<span class="string">"587"</span>,<span class="string">"14 to 17 Years"</span>:<span class="string">"261"</span>,<span class="string">"18 to 24 Years"</span>:<span class="string">"466"</span>,<span class="string">"25 to 44 Years"</span>:<span class="string">"1464"</span>,<span class="string">"45 to 64 Years"</span>:<span class="string">"1290"</span>},
 {<span class="string">"State"</span>:<span class="string">"CT"</span>,<span class="string">"Under 5 Years"</span>:<span class="string">"211"</span>,<span class="string">"5 to 13 Years"</span>:<span class="string">"403"</span>,<span class="string">"14 to 17 Years"</span>:<span class="string">"196"</span>,<span class="string">"18 to 24 Years"</span>:<span class="string">"325"</span>,<span class="string">"25 to 44 Years"</span>:<span class="string">"916"</span>,<span class="string">"45 to 64 Years"</span>:<span class="string">"968"</span>},
 {<span class="string">"State"</span>:<span class="string">"DE"</span>,<span class="string">"Under 5 Years"</span>:<span class="string">"59"</span>,<span class="string">"5 to 13 Years"</span>:<span class="string">"99"</span>,<span class="string">"14 to 17 Years"</span>:<span class="string">"47"</span>,<span class="string">"18 to 24 Years"</span>:<span class="string">"84"</span>,<span class="string">"25 to 44 Years"</span>:<span class="string">"230"</span>,<span class="string">"45 to 64 Years"</span>:<span class="string">"230"</span>}
];

<span class="comment">// manipulate the data into stacked series</span>
<span class="keyword">var</span> spread = fc.data.spread()
    .xValueKey(<span class="string">'State'</span>);
<span class="keyword">var</span> stack = d3.layout.stack();

<span class="keyword">var</span> series = stack(spread(data));

<span class="comment">// create scales</span>
<span class="keyword">var</span> x = d3.scale.ordinal()
    .domain(data.map(<span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d.State; }))
    .rangePoints([<span class="number">0</span>, width], <span class="number">1</span>);

<span class="keyword">var</span> y = d3.scale.linear()
  .domain(fc.util.extent(series, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> <span class="number">0</span>; },
                          <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d.y + d.y0; }))
  .range([height, <span class="number">0</span>]);

<span class="comment">// create the stacked bar series (this could also be line or area)</span>
<span class="keyword">var</span> stack = fc.series.stacked.bar()
  .xScale(x)
  .yScale(y)
  .xValue(<span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d.x; });

<span class="comment">// render</span>
container.append(<span class="string">'g'</span>)
    .datum(series)
    .call(stack);</code></pre>
<p>Which gives the following:</p>
<p><div id="series-stacked" class="chart"> </div></p>
<script type="text/javascript">
(function() {
    var desiredWidth = $('#series-stacked').width(),
        desiredHeight = desiredWidth / 2.4; //keeps the width-height ratio at 600-250 (defaults for createFixture)
    var f = createFixture('#series-stacked', desiredWidth, desiredHeight, null, function() { return true; });
    var container = f.container, data = f.data,
      xScale = f.xScale, yScale = f.yScale,
      height = f.dimensions.height, width = f.dimensions.width;

    var data = [
 {"State":"AL","Under 5 Years":"310","5 to 13 Years":"552","14 to 17 Years":"259","18 to 24 Years":"450","25 to 44 Years":"1215","45 to 64 Years":"641"},
 {"State":"AK","Under 5 Years":"52","5 to 13 Years":"85","14 to 17 Years":"42","18 to 24 Years":"74","25 to 44 Years":"183","45 to 64 Years":"50"},
 {"State":"AZ","Under 5 Years":"515","5 to 13 Years":"828","14 to 17 Years":"362","18 to 24 Years":"601","25 to 44 Years":"1804","45 to 64 Years":"1523"},
 {"State":"AR","Under 5 Years":"202","5 to 13 Years":"343","14 to 17 Years":"157","18 to 24 Years":"264","25 to 44 Years":"754","45 to 64 Years":"727"},
 {"State":"CO","Under 5 Years":"358","5 to 13 Years":"587","14 to 17 Years":"261","18 to 24 Years":"466","25 to 44 Years":"1464","45 to 64 Years":"1290"},
 {"State":"CT","Under 5 Years":"211","5 to 13 Years":"403","14 to 17 Years":"196","18 to 24 Years":"325","25 to 44 Years":"916","45 to 64 Years":"968"},
 {"State":"DE","Under 5 Years":"59","5 to 13 Years":"99","14 to 17 Years":"47","18 to 24 Years":"84","25 to 44 Years":"230","45 to 64 Years":"230"}
];

// manipulate the data into stacked series
var spread = fc.data.spread()
    .xValueKey('State');
var stack = d3.layout.stack();

var series = stack(spread(data));

// create scales
var x = d3.scale.ordinal()
    .domain(data.map(function(d) { return d.State; }))
    .rangePoints([0, width], 1);

var y = d3.scale.linear()
  .domain(fc.util.extent(series, function(d) { return 0; },
                          function(d) { return d.y + d.y0; }))
  .range([height, 0]);

// create the stacked bar series (this could also be line or area)
var stack = fc.series.stacked.bar()
  .xScale(x)
  .yScale(y)
  .xValue(function(d) { return d.x; });

// render
container.append('g')
    .datum(series)
    .call(stack);

}());
</script>



      <nav class="visible-xs-block">
        <ul class="pager">
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                    <li class="previous"><a href="point.html"><span aria-hidden="true">&larr;</span> Point Series</a></li>
                  
                  
                
                  
                  
                
                  
                  
                    <li class="next"><a href="../svg/axis.html">Axis <span aria-hidden="true">&rarr;</span></a></li>
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
              
            
          
            
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        </ul>
      </nav>
    </div>

    <nav class="col-sm-3 hidden-xs">
      <ul class="nav nav-stacked fixed nav-sidebar">
        
          <li>
            
              
                <h4>Introduction</h4>
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
            <ul class="nav nav-stacked">
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                    <li class="">
                      <a href="../introduction/1-getting-started.html">
                        Getting Started
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="../introduction/2-decorate-pattern.html">
                        Decorate Pattern
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="../introduction/3-component-design.html">
                        Component Design
                      </a>
                    </li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            </ul>
          </li>
        
          <li>
            
              
            
              
            
              
                <h4>Chart</h4>
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
            <ul class="nav nav-stacked">
              
                
              
                
              
                
                    <li class="">
                      <a href="../chart/cartesianChart.html">
                        Cartesian Chart
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="../chart/legend.html">
                        Legend
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="../chart/linearTimeSeries.html">
                        Linear Time Series
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="../chart/sparkline.html">
                        Sparkline
                      </a>
                    </li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            </ul>
          </li>
        
          <li>
            
              
            
              
            
              
            
              
                <h4>Series</h4>
              
            
              
            
              
            
              
            
              
            
              
            
              
            
            <ul class="nav nav-stacked">
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                    <li class="">
                      <a href="area.html">
                        Area Series
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="bar.html">
                        Bar Series
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="candlestick.html">
                        Candlestick Series
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="cycle.html">
                        Cycle Series
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="grouped-bar.html">
                        Grouped Bar Series
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="line.html">
                        Line Series
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="multi.html">
                        Multi Series
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="ohlc.html">
                        OHLC Series
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="point.html">
                        Point Series
                      </a>
                    </li>
                
              
                
                    <li class="active">
                      <a href="stacked.html">
                        Stacked Series
                      </a>
                    </li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            </ul>
          </li>
        
          <li>
            
              
            
              
            
              
            
              
            
              
                <h4>Indicators</h4>
              
            
              
            
              
            
              
            
              
            
              
            
            <ul class="nav nav-stacked">
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                    <li class="">
                      <a href="../indicator/bollingerBands.html">
                        Bollinger Bands
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="../indicator/exponentialMovingAverage.html">
                        Exponential Moving Average
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="../indicator/macd.html">
                        MACD
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="../indicator/movingAverage.html">
                        Moving Average
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="../indicator/relativeStrengthIndicator.html">
                        Relative Strength Index
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="../indicator/stochasticOscillator.html">
                        Stochastic Oscillator
                      </a>
                    </li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            </ul>
          </li>
        
          <li>
            
              
            
              
            
              
            
              
            
              
            
              
                <h4>Scale</h4>
              
            
              
            
              
            
              
            
              
            
            <ul class="nav nav-stacked">
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                    <li class="">
                      <a href="../scale/dateTime.html">
                        Date Time Scale
                      </a>
                    </li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            </ul>
          </li>
        
          <li>
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                <h4>SVG</h4>
              
            
              
            
              
            
            <ul class="nav nav-stacked">
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                    <li class="">
                      <a href="../svg/axis.html">
                        Axis
                      </a>
                    </li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            </ul>
          </li>
        
          <li>
            
              
            
              
                <h4>Annotations</h4>
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
            <ul class="nav nav-stacked">
              
                
              
                
                    <li class="">
                      <a href="../annotation/gridlines.html">
                        Gridlines
                      </a>
                    </li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                    <li class="">
                      <a href="../annotation/line.html">
                        Line Annotation
                      </a>
                    </li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            </ul>
          </li>
        
          <li>
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                <h4>Tools</h4>
              
            
              
            
              
            
              
            
            <ul class="nav nav-stacked">
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                    <li class="">
                      <a href="../tool/crosshairs.html">
                        Crosshairs
                      </a>
                    </li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            </ul>
          </li>
        
          <li>
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                <h4>Layout</h4>
              
            
              
            
            <ul class="nav nav-stacked">
              
                
                    <li class="">
                      <a href="../layout/layout.html">
                        Flexbox Layout
                      </a>
                    </li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            </ul>
          </li>
        
          <li>
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                <h4>Data</h4>
              
            
            <ul class="nav nav-stacked">
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                    <li class="">
                      <a href="../data/coinbase.html">
                        Coinbase
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="../data/financial.html">
                        Random Financial
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="../data/quandl.html">
                        Quandl
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="../data/spread.html">
                        Spread
                      </a>
                    </li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            </ul>
          </li>
        
      </ul>
    </nav>

  </div>

</div>


    </div>
    <footer>
      <div class="container">
        <p class="muted credit text-center">Project supported by <a href="http://www.scottlogic.com">Scott Logic</a>.</p>
        <p class="muted credit text-center">Browser testing provided by <a class="browserstack" href="https://browserstack.com">BrowserStack</a>.</p>
      </div>
    </footer>

    
    <script src="//localhost:35729/livereload.js"></script>
  </body>
</html>
